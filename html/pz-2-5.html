<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/>
  <title>Calculator</title>
  <link type="text/css" rel="stylesheet" href="../css/pz-2-5.css">
  <link type="text/css" rel="stylesheet" href="../css/media-query.css">
  <link type="text/css" rel="stylesheet" href="../css/variable.css">
</head>
<body>
<div class="virsta-calculator">
  <div class="virsta-input-text1">
    <input type="text" readonly id="virsta-input-text" class="virsta-input-text">
  </div>

  <div class="virsta-button-help1">
    <input type="button" class="virsta-button-help" value="AC" id="virsta-button-help-AC">
    <input type="button" class="virsta-button-help" value="+/-" id="virsta-button-help-minus">
    <input type="button" class="virsta-button-help" value="%" id="virsta-button-help-interest">
  </div>

  <div class="virsta-button-operations1">
    <input type="button" class="virsta-button-operations virsta-button" value="/"
           id="virsta-button-operations-division">
    <input type="button" class="virsta-button-operations virsta-button" value="*"
           id="virsta-button-operations-multiplication">
    <input type="button" class="virsta-button-operations virsta-button" value="+" id="virsta-button-operations-sum">
    <input type="button" class="virsta-button-operations virsta-button" value="-"
           id="virsta-button-operations-subtraction">
    <input type="button" class="virsta-button-operations" value="=" id="virsta-button-operations-equal">
  </div>

  <div class="virsta-button-number1">
    <div class="virsta-button-number2">
      <input type="button" class="virsta-button-number virsta-button" value="9" id="virsta-button-number-nine">
      <input type="button" class="virsta-button-number virsta-button" value="8" id="virsta-button-number-eight">
      <input type="button" class="virsta-button-number virsta-button" value="7" id="virsta-button-number-seven">
    </div>
    <div class="virsta-button-number2">
      <input type="button" class="virsta-button-number virsta-button" value="6" id="virsta-button-number-six">
      <input type="button" class="virsta-button-number virsta-button" value="5" id="virsta-button-number-five">
      <input type="button" class="virsta-button-number virsta-button" value="4" id="virsta-button-number-four">
    </div>
    <div class="virsta-button-number2">
      <input type="button" class="virsta-button-number virsta-button" value="3" id="virsta-button-number-tree">
      <input type="button" class="virsta-button-number virsta-button" value="2" id="virsta-button-number-two">
      <input type="button" class="virsta-button-number virsta-button" value="1" id="virsta-button-number-one">
    </div>
    <div class="virsta-button-number2">
      <input type="button" class="virsta-button-number virsta-button" value="0" id="virsta-button-number-zero">
      <input type="button" class="virsta-button-number virsta-button" value="." id="virsta-button-number-point">
    </div>
  </div>

  <div class="virsta-button-save1">
    <input type="button" class="virsta-button-save" id="virsta-button-save" value="save">
    <input type="button" class="virsta-button-save" id="virsta-button-output" value=">">
    <input type="button" class="virsta-button-save" id="virsta-button-theme" value="theme">
  </div>
</div>

<script>
  let buttons = document.querySelectorAll(".virsta-button");
  let text = document.querySelector("#virsta-input-text");
  let AC = document.querySelector("#virsta-button-help-AC");
  let minus = document.querySelector("#virsta-button-help-minus");
  let interest = document.querySelector("#virsta-button-help-interest");
  let equal = document.querySelector("#virsta-button-operations-equal");
  let save = document.querySelector('#virsta-button-save');
  let output = document.querySelector('#virsta-button-output');
  let theme = document.querySelector("#virsta-button-theme");

  let numbers = document.querySelectorAll('.virsta-button-number');
  let operations = document.querySelectorAll('.virsta-button-operations');
  let helps = document.querySelectorAll('.virsta-button-help');
  let texts = document.querySelectorAll('.virsta-input-text');
  let texts1 = document.querySelectorAll('.virsta-input-text1');
  let calculator = document.querySelectorAll('.virsta-calculator');

  theme.addEventListener("click", (event) => {
    theme.classList.toggle("virsta-theme-white");

    for(let i = 0; i < numbers.length; i++) numbers[i].classList.toggle("virsta-theme-white");
    for(let i = 0; i < operations.length; i++) operations[i].classList.toggle("virsta-theme-white");
    for(let i = 0; i < helps.length; i++) helps[i].classList.toggle("virsta-theme-white");
    for(let i = 0; i < texts.length; i++) texts[i].classList.toggle("virsta-theme-white");
    for(let i = 0; i < texts1.length; i++) texts1[i].classList.toggle("virsta-theme-white");
    for(let i = 0; i < calculator.length; i++) calculator[i].classList.toggle("virsta-theme-white");

  });

  for (let i = 0; i < buttons.length; i++) {
    buttons[i].addEventListener("click", (event) => {
      text.value += " " + buttons[i].value;
    });
  }

  equal.addEventListener("click", (event) => {
    Equal(event, false);
  });

  AC.addEventListener("click", (event) => {
    text.value = '';
  });

  minus.addEventListener("click", (event) => {
    Equal(event, false);
    if (parseFloat(text.value)) text.value = parseFloat(text.value) * (-1);
  });

  interest.addEventListener("click", (event) => {
    Equal(event, true);
  });

  //path=/file:///D:/my/paru/WEB/pz-2-5; domain=file:///D:/my/paru/WEB/pz-2-5/pz-2-5.html; expires=Tue

  save.addEventListener("click", (event) => {
    deleteCookie("task1");
    document.cookie = `task1=${text.value}`;
  });

  output.addEventListener("click", (event) => {
    text.value = getCookie("task1");
  });

  function getCookie(name) {
    let matches = document.cookie.match(new RegExp(
      "(?:^|; )" + name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g, '\\$1') + "=([^;]*)"
    ));
    return matches ? decodeURIComponent(matches[1]) : undefined;
  }

  function setCookie(name, value, options = {}) {
    if (options.expires instanceof Date) {
      options.expires = options.expires.toUTCString();
    }

    let updatedCookie = encodeURIComponent(name) + "=" + encodeURIComponent(value);

    for (let optionKey in options) {
      updatedCookie += "; " + optionKey;
      let optionValue = options[optionKey];
      if (optionValue !== true) {
        updatedCookie += "=" + optionValue;
      }
    }

    document.cookie = updatedCookie;
  }

  function deleteCookie(name) {
    setCookie(name, "", {
      'max-age': -1
    })
  }

  function Equal(event, inter) {
    let str = text.value.trim();
    str = text.value.split(' ');
    if (!parseFloat(str[0])) str = str.filter((x) => str.indexOf(x) !== 0);
    console.log(str);
    let operation_bool = false;
    let operation_list = [];
    let operation_index = -1;
    let rez = 0;

    if (str.length === 0) text.value = "null";
    else {
      str.forEach((x) => {
        switch (x) {
          case '+':
            operation_bool = true;
            operation_list[operation_list.length] = x;
            operation_index = str.indexOf(x);
            break;
          case '-':
            operation_bool = true;
            operation_list[operation_list.length] = x;
            operation_index = str.indexOf(x);
            break;
          case '*':
            operation_bool = true;
            operation_list[operation_list.length] = x;
            operation_index = str.indexOf(x);
            break;
          case '/':
            operation_bool = true;
            operation_list[operation_list.length] = x;
            operation_index = str.indexOf(x);
            break;
          default:
            break;
        }
      });
      if (operation_bool) {
        if (operation_list.length === 1 && operation_index !== -1) {
          let count = 0;
          let a = 0;
          let b = 0;
          if (inter) {
            switch (operation_list[0]) {
              case '+':
                a = Number(str.filter((x) => count++ < operation_index));
                count = 0;
                b = Number(str.filter((x) => count++ > operation_index));
                rez = a + a * b / 100;
                break;
              case '-':
                a = Number(str.filter((x) => count++ < operation_index));
                count = 0;
                b = Number(str.filter((x) => count++ > operation_index));
                rez = a - a * b / 100;
                break;
              case '*':
                a = Number(str.filter((x) => count++ < operation_index));
                count = 0;
                b = Number(str.filter((x) => count++ > operation_index));
                rez = a * b / 100;
                break;
              default:
                text.value = "null";
                break;
            }
          } else {
            switch (operation_list[0]) {
              case '+':
                a = Number(str.filter((x) => count++ < operation_index));
                count = 0;
                b = Number(str.filter((x) => count++ > operation_index));
                rez = a + b;
                break;
              case '-':
                a = Number(str.filter((x) => count++ < operation_index));
                count = 0;
                b = Number(str.filter((x) => count++ > operation_index));
                rez = a - b;
                break;
              case '*':
                a = Number(str.filter((x) => count++ < operation_index));
                count = 0;
                b = Number(str.filter((x) => count++ > operation_index));
                rez = a * b;
                break;
              case '/':
                a = Number(str.filter((x) => count++ < operation_index));
                count = 0;
                b = Number(str.filter((x) => count++ > operation_index));
                rez = a / b;
                break;
              default:
                text.value = "null";
                break;
            }
          }
          count = 0;
          text.value = rez;
        } else {
          text.value = "null";
        }
      } else {
        text.value = Number(str);
      }
    }
  }

  /**
   * @return {number}
   */
  function Number(arr) {
    let rez = 0;
    let point = arr.filter((x) => x === '.');

    if (point.length === 1) {
      let index = arr.indexOf('.');
      for (let i = 0; i < index; i++) {
        rez += parseInt(arr[i]);
        if (i !== index - 1) {
          rez *= 10;
        }
      }
      let n = 10;
      for (let i = index + 1; i < arr.length; i++) {
        rez += parseInt(arr[i]) / n;
        n *= 10;
      }
    } else if (point.length > 1) {
      text.value = "null";
    } else {
      for (let i = 0; i < arr.length; i++) {
        rez += parseInt(arr[i]);
        if (i !== arr.length - 1) {
          rez *= 10;
        }
      }
    }

    return rez;
  }
</script>
</body>
</html>
